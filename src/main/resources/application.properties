# Connector Admin Service Configuration
quarkus.application.name=connector-admin
quarkus.application.version=1.0.0-SNAPSHOT
# Container Image Configuration
quarkus.container-image.registry=ghcr.io
quarkus.container-image.group=ai-pipestream
quarkus.container-image.name=connector-admin
quarkus.container-image.tag=latest
quarkus.container-image.additional-tags=${quarkus.application.version}
# ======================================================================================================================
# HTTP / gRPC Configuration
# ======================================================================================================================
# Connector service port (38107)
quarkus.http.host=0.0.0.0
quarkus.http.port=38107
quarkus.grpc.server.use-separate-server=false
quarkus.grpc.server.enable-health-service=true
quarkus.grpc.server.enable-reflection-service=true
quarkus.grpc.server.max-inbound-message-size=2147483647
# gRPC client configuration to connect to the repository-service
quarkus.grpc.clients.repository.address=static://localhost:38102 # Point to repo-service
quarkus.grpc.clients.repository.max-inbound-message-size=2147483647
# Dev configuration
%dev.quarkus.http.port=38107
%dev.quarkus.http.root-path=/connector
# Test configuration
%test.quarkus.http.test-port=0
%test.quarkus.grpc.server.use-separate-server=false
# ======================================================================================================================
# Kafka Configuration
# ======================================================================================================================
# IMPORTANT: do not set kafka.bootstrap.servers for %test, otherwise Quarkus Kafka Dev Services won't start.
%dev.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
%prod.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:kafka:9092}
# Kafka Dev Services - disabled when using Compose Dev Services
# Account events consumer channel
# Note: Connector ('smallrye-kafka') and Deserializers (ProtobufKafkaDeserializer/UUIDDeserializer) are
# AUTO-CONFIGURED by the quarkus-apicurio-registry-protobuf extension.
# DO NOT manually configure 'value.deserializer' or 'connector' unless you need to override the defaults.
#
# We only need to specify the topic if it differs from the channel name.
mp.messaging.incoming.account-events.topic=account-events
mp.messaging.incoming.account-events.group.id=connector-admin
# mp.messaging.incoming.account-events.value.deserializer=io.apicurio.registry.serde.protobuf.ProtobufKafkaDeserializer
# ======================================================================================================================
# Database Configuration
# ======================================================================================================================
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=pipeline
quarkus.datasource.password=password
# Dev mode - use MySQL dev service (port 3306) - separate database for connector-admin
%dev.quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3306/pipeline_connector_dev
# Hibernate configuration - use current property names
# Dev: Use Flyway migrations to manage schema
%dev.quarkus.hibernate-orm.schema-management.strategy=none
%dev.quarkus.flyway.migrate-at-start=true
%dev.quarkus.flyway.baseline-on-migrate=true
# Test: Clean database and let Hibernate create schema
%test.quarkus.hibernate-orm.schema-management.strategy=drop-and-create
%test.quarkus.hibernate-orm.sql-load-script=import.sql
%test.quarkus.flyway.migrate-at-start=false
%test.quarkus.flyway.clean-at-start=true
# Prod: Use migrations
%prod.quarkus.hibernate-orm.schema-management.strategy=validate
%prod.quarkus.flyway.migrate-at-start=true
%prod.quarkus.flyway.baseline-on-migrate=true
quarkus.hibernate-orm.sql-load-script=no-file
# ======================================================================================================================
# Dev Services Configuration
# ======================================================================================================================
# Compose Dev Services - Enable shared infrastructure for dev mode
%dev.quarkus.compose.devservices.enabled=true
%dev.quarkus.compose.devservices.files=${user.home}/.pipeline/compose-devservices.yml
%dev.quarkus.compose.devservices.project-name=pipeline-shared-devservices
%dev.quarkus.compose.devservices.start-services=true
%dev.quarkus.compose.devservices.stop-services=false
%dev.quarkus.compose.devservices.reuse-project-for-tests=true
# Kafka Dev Services - enabled, will use compose services when available
%dev.quarkus.kafka.devservices.enabled=true
%dev.quarkus.devservices.timeout=120s
# Test profile - prefer Quarkus Dev Services (Testcontainers) for reliability
%test.quarkus.devservices.enabled=true
# Do not rely on compose-based test services by default (those are used by e2e scripts)
%test.quarkus.compose.devservices.enabled=false
%test.quarkus.kafka.devservices.enabled=true

# Test datasource config - when no JDBC URL is provided, Quarkus will start a MySQL Dev Service.
%test.quarkus.datasource.username=pipeline
%test.quarkus.datasource.password=password
# %test.mp.messaging.incoming.account-events.value.deserializer=io.apicurio.registry.serde.protobuf.ProtobufKafkaDeserializer
# Enable stubbed account validation in tests to remove external dependency on grpc-wiremock
%test.connector.admin.account.validation.stub=true
# ======================================================================================================================
# Service Registration Configuration
# ======================================================================================================================
pipestream.registration.enabled=true
pipestream.registration.service-name=connector-admin
pipestream.registration.description=Connector registry and administration service
pipestream.registration.type=SERVICE
pipestream.registration.advertised-host=${CONNECTOR_SERVICE_HOST:host.docker.internal}
pipestream.registration.advertised-port=${quarkus.http.port}
# Internal host/port for Docker - Consul uses this for health checks
pipestream.registration.internal-host=${DOCKER_BRIDGE_IP:172.17.0.1}
pipestream.registration.internal-port=${quarkus.http.port}
pipestream.registration.capabilities=connector-management,api-key-management
pipestream.registration.tags=connector,admin,core-service

# Registration service connection
pipestream.registration.registration-service.host=localhost
pipestream.registration.registration-service.port=38101

%test.pipestream.registration.enabled=false
# ======================================================================================================================
# Quarkus Index Dependencies
# ======================================================================================================================
quarkus.index-dependency.pipestream-registration.group-id=ai.pipestream
quarkus.index-dependency.pipestream-registration.artifact-id=pipestream-service-registration
quarkus.index-dependency.pipestream-dynamic-grpc.group-id=ai.pipestream
quarkus.index-dependency.pipestream-dynamic-grpc.artifact-id=quarkus-dynamic-grpc
# ======================================================================================================================
# Quinoa Configuration (Vue.js UI)
# ======================================================================================================================
# Static file serving configuration
quarkus.http.static-resources.connector-ui=/connector:build/quinoa/build
